<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LLM Sports Betting Benchmark</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 40px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f4f4f4; }
    h1, h2 { text-align: center; }
  </style>
</head>
<body>
  <h1>LLM Sports Betting Benchmark</h1>
  <p style="text-align:center;">Last updated: <span id="last-updated">LAST_UPDATED_PLACEHOLDER</span></p>

  <h2>Leaderboard</h2>
  <table id="leaderboard">
    <thead>
      <tr>
        <th>Rank</th>
        <th>LLM</th>
        <th>Bankroll</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Cumulative Stats</h2>
  <table id="stats-table">
    <thead>
      <tr>
        <th>LLM</th>
        <th>Avg Odd</th>
        <th>Avg Stake</th>
        <th>Win Rate</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    async function loadData() {
      const leaderboardRes = await fetch("leaderboard_data.json");
      const leaderboardData = await leaderboardRes.json();

      const predictionsRes = await fetch("predictions.json");
      const predictions = await predictionsRes.json();

      const resultsRes = await fetch("results.json");
      const allResults = await resultsRes.json();

      // --- LEADERBOARD ---
      const tbody = document.querySelector("#leaderboard tbody");
      leaderboardData
        .sort((a, b) => b.bankroll - a.bankroll)
        .forEach((row, index) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${index + 1}</td>
            <td>${row.llm}</td>
            <td>${row.bankroll.toFixed(2)}</td>
          `;
          tbody.appendChild(tr);
        });

      // --- CUMULATIVE STATS (resolved bets only) ---
      const statsBody = document.querySelector('#stats-table tbody');
      const stats = {};

      const allGames = predictions.flatMap(p => p.bets.map(b => ({
        llm: p.llm,
        odd: b.odd,
        stake: b.stake,
        bet: b
      })));

      allGames.forEach(game => {
        const llm = game.llm;
        if (!stats[llm]) {
          stats[llm] = { totalOdd: 0, totalStake: 0, totalWin: 0, resolvedCount: 0 };
        }

        const winStatus = isBetWon(game, allResults);
        if (winStatus !== null) {
          stats[llm].resolvedCount++;
          stats[llm].totalOdd += game.odd;     // only resolved bets
          stats[llm].totalStake += game.stake; // only resolved bets
          if (winStatus === true) stats[llm].totalWin++;
        }
      });

      Object.keys(stats).sort().forEach(llm => {
        const item = stats[llm];
        const avgOdd   = item.resolvedCount > 0 ? (item.totalOdd / item.resolvedCount).toFixed(2) : "0.00";
        const avgStake = item.resolvedCount > 0 ? (item.totalStake / item.resolvedCount).toFixed(2) : "0.00";
        const winRate  = item.resolvedCount > 0 ? ((item.totalWin / item.resolvedCount) * 100).toFixed(2) : "0.00";

        const row = statsBody.insertRow();
        row.insertCell(0).textContent = llm;
        row.insertCell(1).textContent = avgOdd;
        row.insertCell(2).textContent = avgStake;
        row.insertCell(3).textContent = `${winRate}%`;
      });
    }

    // Helper: check if bet is resolved and if it won
    function isBetWon(game, allResults) {
      const result = allResults.find(r => r.match_id === game.bet.match_id);
      if (!result) return null; // not resolved yet
      if (result.outcome === game.bet.pick) return true;
      if (result.outcome !== game.bet.pick) return false;
      return null;
    }

    loadData();
  </script>
</body>
</html>
